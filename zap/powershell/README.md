# ZAP PowerShell Scripts

## Run-ZAP-Headless.ps1

Runs OWASP ZAP in headless mode against each split Swagger file generated by the SwaggerSplitter tool.

### Prerequisites

- OWASP ZAP installed at `C:\Program Files\ZAP\Zed Attack Proxy\`
- Split Swagger files generated in the `SplitSwaggerFiles` folder
- PowerShell execution policy set to allow script execution

### PowerShell Execution Policy

If you encounter an error about scripts being disabled, you need to set the execution policy:

**Recommended (one-time setup):**

```powershell
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
```

**Alternative options:**

- Bypass for current session only:

  ```powershell
  Set-ExecutionPolicy -ExecutionPolicy Bypass -Scope Process
  ```

- Run single command with bypass:

  ```powershell
  powershell -ExecutionPolicy Bypass -File .\Run-ZAP-Headless.ps1 -TargetUrl "http://localhost:8080"
  ```

### Usage

#### Basic Usage (with defaults)

```powershell
.\Run-ZAP-Headless.ps1
```

#### Custom Parameters

```powershell
.\Run-ZAP-Headless.ps1 -TargetUrl "http://localhost:8080" -OutputFolder "..\custom-reports"
```

### Parameters

- **SwaggerFolder**: Path to folder containing split Swagger JSON files
  - Default: `..\..\src\Morsley.UK.ZAP.SwaggerSplitter.Console\bin\Debug\net10.0\SplitSwaggerFiles`

- **ZapPath**: Path to ZAP executable
  - Default: `C:\Program Files\ZAP\Zed Attack Proxy\zap.bat`

- **OutputFolder**: Path where ZAP reports will be saved
  - Default: `..\reports`

- **TargetUrl**: Base URL of the API to scan
  - Default: `http://localhost:5000`

### Example

```powershell
# Scan all Swagger files against production API
.\Run-ZAP-Headless.ps1 -TargetUrl "https://api.example.com" -OutputFolder "C:\Reports\ZAP"
```

### Output

The script will:

1. Find all `.json` files in the Swagger folder
2. Run ZAP in headless mode for each file
3. Generate HTML reports in the output folder
4. Display progress and results in the console

Each report will be named: `swagger-{path}-report.html`
